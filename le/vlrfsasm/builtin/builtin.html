<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="keywords" content="駒場東邦物理部,駒場東邦,駒東,KTPC,物理部,プログラミング,講習,Vlrfsasm"><meta name="description" content="駒場東邦物理部(KTPC)部員向けVlrfsasm講習の資料です。"><meta name="author" content="駒場東邦物理部"><meta http-equiv="content-language" content="ja"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>組み込み関数 - Vlrfsasm講習 - 駒場東邦物理部</title><link rel="icon" type="image/jpeg" href="../../../images/logo.jpg"><link rel="stylesheet" type="text/css" href="../../../tool/vlrfsasmKtpc/style/default.css"><link rel="stylesheet" type="text/css" media="(max-width:800px)" href="../../../tool/vlrfsasmKtpc/style/narrow.css"><script src="../../../tool/vlrfsasmKtpc/js/search.js"></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-133906591-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-133906591-2')</script></head><body class="hBody"><header class="hHeader"><image class="hBanner" src="../../../images/br.jpg"></header><div class="hBeneathHeader"><div class="hMenuSide"><div class="hMenuBack"><div class="hMenuButtonBack"><button class="hMenuButton" onclick="menu()"><image class="hMenuButtonImage" src="../../../images/menu.png"></button></div><div class="hMenuLink" style="display: none; pointer-events: none;" id="menuLink"><div class="hMenuLinkGroup"><div class="hMenuLinkTitle"><span class="hMenuLinkText">駒場東邦物理部</span></div><a class="hMenuLinkElement" href="../../../index.html"><span class="hMenuLinkText">トップページ</span></a><a class="hMenuLinkElement" href="../../../le/le.html"><span class="hMenuLinkText">講習トップ</span></a></div><div class="hMenuLinkGroup"><div class="hMenuLinkTitle"><span class="hMenuLinkText">Vlrfsasm講習</span></div><a class="hMenuLinkElement" href="../function/function.html"><span class="hMenuLinkText">関数</span></a><a class="hMenuLinkElement" href="../vlrfsasm.html"><span class="hMenuLinkText">講習トップ</span></a><a class="hMenuLinkElement" href="../library/library.html"><span class="hMenuLinkText">ライブラリ</span></a></div></div><div class="hMenuWord" style="display: none; pointer-events: none;" id="menuWord"></div></div></div><div class="hContentSide"><div class="hContentBack"><article class="cArticle"><h2 class="cArticleTitle">概要</h2><div class="cArticleCaption"><p class="cP">本章では、Vlrfsasmの文法で予め定められている14個の関数について解説します。なお、出力関数は含めていません。</p></div></article><article class="cArticle"><h2 class="cArticleTitle">幅取得関数</h2><div class="cArticleCaption"><p class="cP">値の幅を取得する関数は、<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">#</span></span></span>です。</p></div><section class="cSection"><h2 class="cSectionTitle">引数</h2><p class="cP">この関数の引数は1つのみで、幅を取得したい値を指定します。数値リテラルを指定すれば64が返ってきます。</p></section><section class="cSection"><h2 class="cSectionTitle">返り値</h2><p class="cP">当然返り値にも幅があり、この関数では64ビットに固定されています。ただし、実際に使われるのは下位20ビットのみで、上位44ビットは常に0です。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">連接関数</h2><div class="cArticleCaption"><p class="cP">値を連接する関数は、<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">'</span></span></span>です。</p></div><section class="cSection"><h2 class="cSectionTitle">用法</h2><p class="cP">この関数の引数は、1つ以上ならいくつでもよいです。左側の引数が上位になるように連接され、返り値の幅は各引数の幅の和です。文字コードが同じ文字列ならば、この関数で繋げて1つの文字列にできます。また、構造体を作ることもできます。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">範囲操作関数群</h2><div class="cArticleCaption"><p class="cP">幅を読み取る関数があれば、変更する関数もあります。</p></div><section class="cSection"><h2 class="cSectionTitle">引数</h2><p class="cP">以下の3関数の引数は共通で、第一引数に対象の値、第二引数に幅を指定します。第二引数は、幅が20ビットに満たない場合、上位に0をつけて拡張されます。また、<svg class="cSvg" width="85px" height="19px" viewBox="0 0 85 19" xmlns="http://www.w3.org/2000/svg" stroke="none" fill="black"><text x="0.00" y="18.64" font-size="16.00px">2</text><text x="8.00" y="7.99" font-size="12.00px">19</text><text x="24.00" y="18.64" font-size="16.00px">=524288</text></svg>を超える場合は、524288と解釈されます。</p></section><section class="cSection"><h2 class="cSectionTitle">幅変更関数</h2><p class="cP">関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">:</span></span></span>は、第一引数について、幅を第二引数に変えて返します。つまり、第一引数の幅が第二引数より小さいときは、上位に必要なだけ0を付け足して返します。一方、大きいときは、上位のビットを削って返します。等しいときは第一引数がそのまま返ってきます。</p></section><section class="cSection"><h2 class="cSectionTitle">左シフト関数</h2><p class="cP">関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">&lt;</span></span></span>は、第一引数の下位に、第二引数ビットの0を付け足します。</p></section><section class="cSection"><h2 class="cSectionTitle">右シフト関数</h2><p class="cP">関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">&gt;</span></span></span>は、第一引数の下位から第二引数ビットを削り、残りを返します。なお、第一引数の幅が第二引数以下であるときには、幅0の値を返します。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">演算関数群</h2><div class="cArticleCaption"><p class="cP">以下の5つの関数は、値の計算を行う関数です。ビット否定関数を除く4つは、1つ以上ならいくつでも引数を取ることができます。返り値の幅は、繰り上がりなどに関わらず常に第一引数の幅と同じです。引数の順番によって結果が変わることに注意してください。また、幅の違う値同士の計算は、最下位を揃えて行われます。第一引数より短い引数があった場合、足りない上位は0として扱われます。</p></div><section class="cSection"><h2 class="cSectionTitle">ビット否定関数</h2><p class="cP">ビット否定関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">!</span></span></span>は、Vlrfsasmの組み込み関数で最も単純なものです。引数を1つ取り、全てのビットを反転して返します。返り値の幅は引数の幅と同じです。</p></section><section class="cSection"><h2 class="cSectionTitle">加算関数</h2><p class="cP">加算関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">+</span></span></span>は、引数の和を返します。なお、この関数は他の関数や機能を用いて表現することができますが、実行時の計算量を抑えるため、組み込み関数にしています。</p></section><section class="cSection"><h2 class="cSectionTitle">ビット積関数</h2><p class="cP">ビット積関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">&amp;</span></span></span>は、1ビットごとに論理積を取ります。1つでも0があれば結果も0ですから、第二引数以降に第一引数より短いものがないか注意しましょう。</p></section><section class="cSection"><h2 class="cSectionTitle">ビット和関数</h2><p class="cP">ビット和関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">|</span></span></span>は、1ビットごとに論理和を取ります。</p></section><section class="cSection"><h2 class="cSectionTitle">排他的ビット和関数</h2><p class="cP">排他的ビット和関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">^</span></span></span>は、1ビットごとに排他的論理和を取ります。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">選択関数</h2><div class="cArticleCaption"><p class="cP">選択関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">?</span></span></span>は、特殊な関数です。構文というべきかもしれません。これは、第一引数に従い、第二引数と第三引数のいずれかを返します。</p></div><section class="cSection"><h2 class="cSectionTitle">引数</h2><p class="cP">第一引数は、条件です。第一引数の全てのビットが0であるか、または第一引数の幅が0であるとき、条件は偽です。そうでないとき、つまり1つでも1のビットが含まれるときが真です。第二引数と第三引数にはどんな値でもちょうど1つずつを指定できます。どの引数も省略してはいけません。</p></section><section class="cSection"><h2 class="cSectionTitle">動作</h2><p class="cP">条件が真と判断された場合、第二引数の値を計算して返します。偽であれば第三引数を実行して返します。この順序が選択関数の特殊な点で、遅延評価を行います。Vlrfsasmはここ以外では正格評価を行い、引数を計算してから関数を実行します。しかし、選択関数は条件分岐の役割を持つので、遅延評価とすることで再帰を使えるようにしています。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">エラー関数</h2><div class="cArticleCaption"><p class="cP">エラー関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">~</span></span></span>も特殊な関数です。これは最早関数ですらありません。値を返さないどころか、Vlrfsasmの実行をそこで止めてしまいます。引数の値は文字列で、ログの最下部に出力されます。</p></div><section class="cSection"><h2 class="cSectionTitle">文字コード</h2><p class="cP">引数に文字列リテラルを直接指定することはできません。これは実装時に面倒に思った結果、UTF-16LEで解釈する仕様だからです。次章で解決策を説明します。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">その他</h2><div class="cArticleCaption"><p class="cP">さて、律儀に数えた人は、本章でさらに2関数の説明があるものと思うでしょう。それらの名前は<span class="cCodeSingle"><span class="qLine"><span class="qVlrLabel">@</span></span></span>と<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">`</span></span></span>です。しかし、中身はまだ実装されていません。関数定義時に名前が被らないように気をつけてください。</p></div><section class="cSection"><h2 class="cSectionTitle">理由</h2><p class="cP">これらは、アセンブラとして使うためのラベルを扱う関数もどきと関数なのですが、本HPには必要ないので、後回しにされ続けています。かわいそうですね。</p></section></article></div></div><div class="hFooterSide"><footer class="hFooter"><button class="hFooterButton" onclick="scrollToTop()"><image class="hFooterButtonImage" src="../../../images/top.png"></button><span class="hFooterText">(C) 2020 駒場東邦物理部</span></footer></div></div></body></html>