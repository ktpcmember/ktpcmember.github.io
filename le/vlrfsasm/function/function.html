<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="keywords" content="駒場東邦物理部,駒場東邦,駒東,KTPC,物理部,プログラミング,講習,Vlrfsasm"><meta name="description" content="駒場東邦物理部(KTPC)部員向けVlrfsasm講習の資料です。"><meta name="author" content="駒場東邦物理部"><meta http-equiv="content-language" content="ja"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>関数 - Vlrfsasm講習 - 駒場東邦物理部</title><link rel="icon" type="image/jpeg" href="../../../images/logo.jpg"><link rel="stylesheet" type="text/css" href="../../../tool/vlrfsasmKtpc/style/default.css"><link rel="stylesheet" type="text/css" media="(max-width:800px)" href="../../../tool/vlrfsasmKtpc/style/narrow.css"><script src="../../../tool/vlrfsasmKtpc/js/search.js"></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-133906591-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-133906591-2')</script></head><body class="hBody"><header class="hHeader"><image class="hBanner" src="../../../images/br.jpg"></header><div class="hBeneathHeader"><div class="hMenuSide"><div class="hMenuBack"><div class="hMenuButtonBack"><button class="hMenuButton" onclick="menu()"><image class="hMenuButtonImage" src="../../../images/menu.png"></button></div><div class="hMenuLink" style="display: none; pointer-events: none;" id="menuLink"><div class="hMenuLinkGroup"><div class="hMenuLinkTitle"><span class="hMenuLinkText">駒場東邦物理部</span></div><a class="hMenuLinkElement" href="../../../index.html"><span class="hMenuLinkText">トップページ</span></a><a class="hMenuLinkElement" href="../../../le/le.html"><span class="hMenuLinkText">講習一覧</span></a></div><div class="hMenuLinkGroup"><div class="hMenuLinkTitle"><span class="hMenuLinkText">Vlrfsasm講習</span></div><a class="hMenuLinkElement" href="../grammar/grammar.html"><span class="hMenuLinkText">文法</span></a><a class="hMenuLinkElement" href="../vlrfsasm.html"><span class="hMenuLinkText">講習トップ</span></a><a class="hMenuLinkElement" href="../builtin/builtin.html"><span class="hMenuLinkText">組み込み関数</span></a></div></div><div class="hMenuWord" style="display: none; pointer-events: none;" id="menuWord"></div></div></div><div class="hContentSide"><div class="hContentBack"><article class="cPageTitleBack"><h1 class="cPageTitle">Vlrfsasm講習/関数</h1></article><article class="cArticle"><h2 class="cArticleTitle">概要</h2><div class="cArticleCaption"><p class="cP">Vlrfsasmは、純粋な関数型言語です。別の言い方をすれば、関数以外にプログラミング要素はありません。関数を使いこなすことができれば、Vlrfsasmでできることはほぼ全てできます。</p></div><section class="cSection"><h2 class="cSectionTitle">エラーについて</h2><p class="cP">本章以降、実行するとエラーが発生する可能性があります。指定した<span class="cCodeSingle"><span class="qLine"><span class="qPathName">.log</span></span></span>ファイルに書き込まれているはずなので、<a class="cLink" href="../error/error.html">エラーの章</a>と一緒に読んでください。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">定義</h2><div class="cArticleCaption"><p class="cP">まずは関数の定義を学びましょう。</p><div class="cTableBack"><table class="tXC"><caption>関数の要素</caption><tr><td>名前</td><td>関数を他の関数と区別する識別子</td></tr><tr><td>引数</td><td>実行前に関数に渡される値</td></tr><tr><td>返り値</td><td>関数から実行後に返される値</td></tr></table></div></div><section class="cSection"><h2 class="cSectionTitle">名前</h2><p class="cP">関数の名前には、制限があります。</p><div class="cTableBack"><table class="tXC"><tr><td>規則</td><td>良い例</td><td>悪い例1</td><td>悪い例2</td></tr><tr><td>単一の符であること</td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">getSecondElement</span></span></span></td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">get</span><span class="qVlrSplit"> </span><span class="qVlrName">element2</span></span></span></td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">getElement</span><span class="qVlrSymbol">(</span><span class="qVlrName">second</span><span class="qVlrSymbol">)</span></span></span></td></tr><tr><td>リテラルの形でないこと</td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">階乗</span></span></span></td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrString">"factorial"</span></span></span></td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrNumber">0x66</span></span></span></td></tr><tr><td>唯一の名前であること</td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">ifContainedIt</span></span></span>と<span class="cCodeSingle"><span class="qLine"><span class="qVlrName">ifContainEdit</span></span></span></td><td><span class="cCodeSingle"><span class="qLine"><span class="qVlrName">ifcontainedit</span></span></span></td><td></td></tr></table></div></section><section class="cSection"><h2 class="cSectionTitle">引数</h2><p class="cP">関数のうち、どのように呼び出しても同じ結果が返ってくるものを、定数関数といいます。</p><p class="cP">逆に言えば、定数関数以外の関数は、条件によって異なる結果を返します。この条件を関数に与えるのが引数です。ただし、Vlrfsasmにおいては、関数が使わない引数を持っていても構いません。</p><p class="cP">引数の数は1つの関数につき1通りのみです。全ての値が引数になれます。前章の通り、型はありません。また、1つの関数が17個以上の引数をもつことはできません。</p><p class="cP">引数の名前の規則は、前項に示した関数の名前の規則とほぼ同じです。ただし、他の関数の引数とは、名前が被っていても構いません。類似の関数であれば、引数名が共通であると読みやすいでしょう。</p></section><section class="cSection"><h2 class="cSectionTitle">返り値</h2><p class="cP">関数を実行すると、結果が返されます。Vlrfsasmにおいては、必ずちょうど1つの値を返さなくてはなりません。この値のことを返り値といいます。</p></section><section class="cSection"><h2 class="cSectionTitle">構文</h2><p class="cP">実際に関数を定義する構文は、以下の通りです。</p><p class="cP"><div class="cCodeFrame"><div class="cCodeMenu"><span class="cCodeMenuTitle">関数定義</span><button class="cCodeMenuElement cCodeMenuButton" onclick="expandCode(this)"><image class="cCodeMenuIcon" src="../../../images/icon/expand.svg"><span class="cCodeMenuText">EXPAND</span></button><button class="cCodeMenuElement cCodeMenuButton cCodeMenuInvisible" onclick="contractCode(this)"><image class="cCodeMenuIcon" src="../../../images/icon/contract.svg"><span class="cCodeMenuText">CONTRACT</span></button><button class="cCodeMenuElement cCodeMenuButton cCodeMenuRight" onclick="copyScript(this)"><image class="cCodeMenuIcon" src="../../../images/icon/copy.svg"><span class="cCodeMenuText">COPY</span></button><span class="cCodeMenuElement cCodeMenuRight cCodeMenuInvisible"><image class="cCodeMenuIcon" src="../../../images/icon/done.svg"><span class="cCodeMenuText">COPIED!</span></span></div><code class="cCodeMulti cCodeContracted"><pre class="cCodePre"><span class="qLine"><span class="qComMetaComment qComRRed">引数をもつ定数関数</span><span class="qVlrSplit"><span class="qComRRed"></span></span><span class="qLine qLineEven"><span class="qVlrSplit"></span></span></span><span class="qLine qLineEven"><span class="qVlrSplit"></span><span class="qVlrSymbol">{</span><span class="qComURed"><span class="qVlrName">constA</span></span><span class="qVlrSplit"> </span><span class="qComUGreen"><span class="qVlrName">Dummy</span></span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qComUBlue"><span class="qVlrNumber">10</span></span><span class="qVlrSymbol">}</span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit"></span><span class="qComMetaComment qComRGreen">引数を省略した定数関数</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit"></span><span class="qVlrSymbol"><span class="qComRGreen">{</span></span><span class="qComURed"><span class="qVlrName">constB</span></span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qComUBlue"><span class="qVlrString">"Hello!"</span></span><span class="qVlrSymbol">}</span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit"></span><span class="qComMetaComment qComRRed">第一引数の値を返す関数</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit"></span><span class="qVlrSymbol"><span class="qComRRed">{</span></span><span class="qComURed"><span class="qVlrName">functionA</span></span><span class="qVlrSplit"> </span><span class="qComUGreen"><span class="qVlrName">Argument</span></span><span class="qVlrSplit"> </span><span class="qComUGreen"><span class="qVlrName">Dummy</span></span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qComUBlue"><span class="qVlrName">Argument</span></span><span class="qVlrSymbol">}</span></span></pre></code></div></p><p class="cP">ここで、<span class="xUnderlineRed">関数名</span>と<span class="xUnderlineBlue">返り値</span>が必ず存在し、<span class="xUnderlineGreen">引数</span>が任意にあることがわかると思います。</p></section><section class="cSection"><h2 class="cSectionTitle">定義位置</h2><p class="cP">関数の定義位置は、言語によって異なります。</p><div class="cTableBack"><table class="tXC"><caption>定義位置の主な例</caption><tr><td>A</td><td>関数を呼び出す位置より前</td></tr><tr><td>B</td><td>プログラムの実行時より前</td></tr><tr><td>C</td><td>関数を呼び出す時より前</td></tr><tr><td>D</td><td>プログラムが終了する前</td></tr></table></div><p class="cP">VlrfsasmはCにあたります。実行されない関数は未定義であっても構わないのがBとの違いです。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">出力関数</h2><div class="cArticleCaption"><p class="cP">Vlrfsasmの実行結果は、ファイルで出力されます。この出力内容を定めるのが、出力関数です。</p></div><section class="cSection"><h2 class="cSectionTitle">名前</h2><p class="cP">出力関数の名前は、ピリオド1字<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">.</span></span></span>です。これは言語仕様なので、別の関数を出力関数にしたり、この名前を出力関数でないようにするといったことはできません。ただし、出力関数の中で別の関数を呼び出せば、前者は実質的に実現できます。</p><p class="cP">また、符がピリオド1字のみの場合が出力関数になるので、他の文字も含む名前は自由に使えます。</p></section><section class="cSection"><h2 class="cSectionTitle">用法</h2><p class="cP">出力関数は、他の関数と同じく1度しか定義できず、その返り値が実行結果として出力されます。つまり、Vlrfsasmで出力できる値は1つだけです。</p><p class="cP">Vlrfsasmは、ソースコードを解釈した後、出力関数を実行します。そして、返り値を決定できるまで、定義に含まれる関数を次々に呼び出します。他の関数から呼び出されるものではないので、引数はありません。引数を定義してしまうとエラーになる可能性があります。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">呼び出し</h2><div class="cArticleCaption"><p class="cP">ここまで断りもなく「呼び出し」という言葉を使ってきましたが、これについて解説します。関数の定義を先に説明しないと、例を実行できないためでした。</p></div><section class="cSection"><h2 class="cSectionTitle">構文</h2><p class="cP">関数を呼び出す構文は、「S式」というものを採用しています。これは、関数名と引数を、丸かっこ内にスペース区切りで並べるものです。あまり普及はしていませんが、Vlrfsasmの構文は他に関数定義のものしか必要としません。汎用性が高く、とても簡潔に書ける構文なのです。</p><p class="cP">例を見てみましょう。丸かっこ内の最初の符が関数名で、2つ目以降の符は引数です。なお、引数の個数はその関数の定義と一致する必要があります。順番も書いた順がそのまま割り当てられます。引数には、リテラル、呼び出し元関数の引数、または別の関数の返り値を指定できます。</p><p class="cP"><div class="cCodeFrame"><div class="cCodeMenu"><span class="cCodeMenuTitle">関数呼び出しの例</span><button class="cCodeMenuElement cCodeMenuButton" onclick="expandCode(this)"><image class="cCodeMenuIcon" src="../../../images/icon/expand.svg"><span class="cCodeMenuText">EXPAND</span></button><button class="cCodeMenuElement cCodeMenuButton cCodeMenuInvisible" onclick="contractCode(this)"><image class="cCodeMenuIcon" src="../../../images/icon/contract.svg"><span class="cCodeMenuText">CONTRACT</span></button><button class="cCodeMenuElement cCodeMenuButton cCodeMenuRight" onclick="copyScript(this)"><image class="cCodeMenuIcon" src="../../../images/icon/copy.svg"><span class="cCodeMenuText">COPY</span></button><span class="cCodeMenuElement cCodeMenuRight cCodeMenuInvisible"><image class="cCodeMenuIcon" src="../../../images/icon/done.svg"><span class="cCodeMenuText">COPIED!</span></span></div><code class="cCodeMulti cCodeContracted"><pre class="cCodePre"><span class="qLine"><span class="qVlrSymbol">{</span><span class="qVlrBuiltin">.</span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">(</span><span class="qVlrName">funcA</span><span class="qVlrSymbol">)</span><span class="qVlrSymbol">}</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit"></span><span class="qVlrSymbol">{</span><span class="qVlrName">funcA</span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">(</span><span class="qVlrName">funcB</span><span class="qVlrSplit"> </span><span class="qVlrNumber">1234</span><span class="qVlrSymbol">)</span><span class="qVlrSymbol">}</span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit"></span><span class="qVlrSymbol">{</span><span class="qVlrName">funcB</span><span class="qVlrSplit"> </span><span class="qVlrName">X</span><span class="qVlrSymbol">;</span><span class="qVlrSplit"> </span><span class="qVlrSymbol">;</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit">  </span><span class="qComMetaComment qComRRed">UTF-16BEからUTF-8への変換</span><span class="qComMetaHidden">[UTF-8への変換関数]</span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit">  </span><span class="qVlrSymbol"><span class="qComRRed">(</span></span><span class="qVlrName">c.convertSbS8</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit">  <span class="qComRRed"> </span> </span><span class="qComMetaComment qComRBlue">非負整数を10進文字列に変換</span><span class="qComMetaHidden">[文字列への変換関数]</span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit">  <span class="qComRRed"> </span> </span><span class="qVlrSymbol"><span class="qComRBlue">(</span></span><span class="qVlrName">c.convertISb</span><span class="qVlrSplit"> </span><span class="qVlrName">X</span><span class="qVlrSplit"> </span><span class="qVlrNumber">10</span><span class="qVlrSymbol">)</span><span class="qVlrSplit"></span></span><span class="qLine qLineEven"><span class="qVlrSplit">  </span><span class="qVlrSymbol"><span class="qComRRed">)</span></span><span class="qVlrSplit"></span></span><span class="qLine"><span class="qVlrSplit"></span><span class="qVlrSymbol">}</span></span></pre></code></div></p></section><section class="cSection"><h2 class="cSectionTitle">スタック</h2><p class="cP">動作の面から言うと、Vlrfsasmはスタックマシンです。関数の呼び出し時の引数は、その関数内で別の関数を呼び出したり、自己再帰をしても、変化しません。</p><p class="cP">スタックの深さには限りがあり、現在は128段以上の呼び出しができません。再帰を使う際には注意してください。</p></section></article><article class="cArticle"><h2 class="cArticleTitle">テスト</h2><div class="cArticleCaption"><p class="cP">本章からは、簡単な問題を付けておきます。</p></div><section class="cSection"><h2 class="cSectionTitle">問1</h2><p class="cP">関数<span class="cCodeSingle"><span class="qLine"><span class="qVlrBuiltin">+</span></span></span>は、定義済みの関数で、加算を表します。この関数は、例外的に可変個の引数を持ちます。1個以上ならいくつでもよいのです。</p><p class="cP">さて、これを用いて計算をしましょう。非負整数をいくつか決めてください。そして、その和をもとめ、10進文字列にしてUTF-8形式で出力してください。ただし、和は<svg class="cSvg" width="61px" height="20px" viewBox="0 0 61 20" xmlns="http://www.w3.org/2000/svg" stroke="none" fill="black"><text x="0.00" y="19.64" font-size="16.00px">1.8×</text><text x="32.87" y="19.64" font-size="16.00px">10</text><text x="48.87" y="8.99" font-size="12.00px">19</text></svg>以下になるようにしましょう。</p></section><section class="cSection"><h2 class="cSectionTitle">問2</h2><p class="cP">関数<svg class="cSvg" width="73px" height="17px" viewBox="0 0 73 17" xmlns="http://www.w3.org/2000/svg" stroke="none" fill="black"><text x="0.00" y="13.00" font-size="16.00px">f(x)=2x+5</text></svg>を定義してください。なお、関数名等との区別をつけるため、引数名は大文字で始めるとよいでしょう。結果も問1と同様に出力してください。</p></section></article></div></div><div class="hFooterSide"><footer class="hFooter"><button class="hFooterButton" onclick="scrollToTop()"><image class="hFooterButtonImage" src="../../../images/top.png"></button><span class="hFooterText">(C) 2020 駒場東邦物理部</span></footer></div></div></body></html>