# 講習資料コンバータードキュメント v2.0

# 概要
講習資料を作るためのコンバーターです。文法のセクションに従った記述をされたテキストファイル（改行文字はLF又はCRLF）を、使用のセクションに従って`app.js`を使用することで、講習資料のhtmlファイルを生成することが出来ます。新たに開発をするときは、一番下に書いてある開発の場所を読んで適切に行いましょう。

# 使用
## node.js
node.jsを使用し、CLI上で実行することを想定しています。入れてないのならさっさと入れてきてください。

## npm
npmを使用して、`xmlhttprequest`をインストールしてください。コードのコンバーター部分でネットを介して定義ファイルを取得してくるために必要です。

## ktpcmd
UTF-8（BOMなし）で書いてください。文法のセクションを参照して用意してください。拡張子は`ktpcmd`にしておけばいいと思います。まあ、拡張子なんてなくたって変わらないんですけど。以下では、ソースファイルになるテキストファイルのことは`ktpcmd`と呼ぶことにします。

## コマンドライン引数
コマンドライン引数は、以下を取ります
1. `ktpcmember.github.io`のフォルダパス、`index.html`がある階層のこと
2. `ktpcmd`のファイルパス。もちろんUTF-8（BOMなし）で書いておいてください。
3. 生成されたhtmlファイルの出力先ディレクトリ。ファイル名まで書いてもいいです。

ちなみに、3にディレクトリを入力した場合、出力されるhtmlのファイル名は、`ktpcmd`のファイルの名前を引っ張ってきます。嫌だったらファイル名まで書いてね。

## おすすめ
一々入力するのは面倒だし、こういう準備をしておくと便利だよって話。

0. `ktpcmd`環境変数を作って、`app.js`のフルパスを登録しておく。
1. `ktpc_root`環境変数を作って、`ktpcmember.github.io`のフォルダパスを登録しておく。
2. `build.cmd`みたいな名前のバッチファイルを作る。
3. `build.cmd`に、以下を記入しておく。
4. `build.cmd`を叩く。
```
node "%ktpcmd%" "%ktpc_root%" "%ktpc_root%\（残りのフォルダパス）" "%ktpc_root%\（残りのフォルダパス）"
```

# 文法
## 序
ktpcmdでは、jsの正規表現を利用してマッチングを行っています。文法には階層が定義されており、より上の階層でマッチした部分が、続く階層のマッチに掛けられます。要するに、文法に従っていない部分は講習資料コンバーターは全く感知しないので、htmlファイルにも反映されません。

## 文法記法
```
「something」
```
somethingをそのまま記入する必要があることを示します
```
（something）
```
その行よりも下で記法を定義します。下のように定義されます。
```
｛something｝:｛...｝
```
...の部分に書かれている内容が定義になります。文法表記で使用されている`「` `」` `（` `）` `｛` `｝`は、`ktpcmd`に記述するものでは無いことに注意して下さい。

## 事前定義（改行、空白）
`ktpcmd`で許容される改行はCRLF又は、LFです。実際のスクリプトでは、CRLFをLFにreplaceした後に、処理をするため、以下ではLFのみを改行として表記します。
```
（改行）

｛改行｝：｛ktpcmdでのCRLF又はLF｝
```
ECMAScrpitで定義される「\s」文字クラスから改行文字のCR、LF、CRLFを除いた集合のことです。要するに、ECMAScriptの文字クラス記法で列挙すると、「\[\f\t\v​\u00a0\u1680​\u180e\u2000​-\u200a​\u2028\u2029\u202f\u205f​\u3000\ufeff]」のことです。（\u___は、ユニコードポイントのこと）
```
（空白）

｛空白｝：｛ECMAScriptで定義される、"\s"文字クラスから改行を除いたもの｝
```

## セクション
まず、ktpcmdでは、ファイルを次の三つのセクションに分けて解釈します。

0. meta
1. header
2. main

## metaセクション
`metaセクション`では、その名前の通り、htmlファイルのmetaタグの部分について弄ります。`title文`と`keywords文`と`description文`を用意しています。

#### title、keywords、description文（文法）
```
（文指定子）（操作指定子）（オペランド文字列）

｛文指定子｝：｛「title」又は「keywords」又は「description」｝
｛操作指定子｝：｛「=」又は「+=」｝
｛オペランド文字列｝：｛「"」（文字列）「"」｝
｛文字列｝：｛改行、ダブルクオーテーションを含まない文字列、エスケープシーケンスは利用不可｝
```

### title文
ブラウザのタブの所に出てくるタイトルを指定する文です。操作指定子に「`+=`」を使用した際は、以下の文字列の**前**に単純に結合されます。
```
 - 駒場東邦物理部
```

### keywords文
\<html>\<head>以下の\<meta>タグにある`keywords属性`を指定する文です。操作指定子に「`+=`」を使用した際は、以下の文字列の**後**に単純に結合されます。ただし、「`,`」を先頭に付ける必要があることに注意して下さい。
```
駒場東邦物理部,駒場東邦,駒東,KTPC,物理部,プログラミング,講習
```

#### description文
\<html>\<head>以下の\<meta>タグの`description属性`を指定する文です。操作指定子に「`+=`」を使用した際も、「`=`」と同様の効果になります。（空文字列と連結されるため）

## headerセクション
`headerセクション`は、講習資料のページの`menu`のリンク張りをするためのセクションです。`name文`、`top文`、`before文`、`next文`、`index文`が用意されています。また、後者4つはパスがない場合、`404.html`へのリンクになります。

### name、top、before、next、index文（文法）
```
（文指定子）「=」（オペランド文字列）

｛文指定子｝：｛「name」又は「top」又は「before」又は「next」又は「index」｝
｛オペランド文字列｝：｛「"」（文字列）「"」｝
｛文字列｝：｛改行、ダブルクオーテーションを含まない文字列、エスケープシーケンスは利用不可｝
```

### name文
`menu`の「○○講習」の部分を指定します。上の方は「駒場東邦物理部」なので、変更する必要がないので、下の「○○講習」の部分だけを指定することにしてます。

### top、index文
`top文`はその講習のトップページ、`index文`はその講習の索引へのパスを`オペランド文字列`に指定します。パスは、`ktpcmember.github.io`のフォルダを基底として記述します。（例：`"le\_cps\_cps.html"`）

### before、next文
`before文`は前回、`next文`は次回の講習資料へのパスを`オペランド文字列`に指定します。パスは、`ktpcmember.github.io`のフォルダを基底として記述します。

## mainセクション
`mainセクション`では、講習ページの実際の内容部分を記述します。`mainセクション`では、次の階層に当たる、`ブロック`が定義されています。`mainセクション`で該当した`ブロック`は、`ktpcmd`に書かれている順番を保持して変換されます。すなわち、後に説明する`タイトルブロック`を、最後に書くと、htmlでもタイトル部分が一番最後に書かれてしまい、明らかにおかしいページが生成されることになるため、注意が必要です。また、**ブロックの最後には改行を一つ多く入れておきましょう**、そうしないとhtmlに反映されない可能性があります。そして、定義されている`ブロック`は以下です。

0. タイトル（h1）
1. 青段落（h2）
2. 白段落（h3）
3. 折り畳み段落
4. コード
5. 左表
6. 右表

### タイトルブロック
`タイトルブロック`は、`mainセクション`の中の一番初めに位置するべきで、講習資料のタイトル表示の部分を指定するために使用します。文法は以下です。
```
「#」（空白）（タイトル文字列）（改行）（改行）

｛タイトル文字列｝：｛改行を含まない文字列（正規表現上では、改行が二個並ばなければ許容）｝
```

### 青段落、白段落、折り畳み段落ブロック
`青段落ブロック`、`白段落ブロック`、`折り畳み段落ブロック`は、それぞれh2タグのやつ、h3タグのやつ、detail-summaryのやつです。本文のほとんどはこれらを使用して書かれる事でしょう。
```
（指示子）（空白）（見出し文字列）（改行）（本文）（改行）（改行）

｛指示子｝：｛青段落/白段落/折り畳み段落それぞれ「##」、「###」、「@」｝
｛見出し文字列｝：｛タイトルブロック>タイトル文字列と同義｝
｛本文｝：｛あらゆる文字（ユニコードポイント）、改行が二つ続くと終了するので注意｝
```

### コード、折り畳みコードブロック
名前の通り。Discordよろしくで言語モードあるので、jsの方で対応させれば結構便利だったりするかもしれない。折り畳みの方は、detail-summaryに埋もれる方のコードブロック。言語モード拡張するときは頑張って。搭載されてる言語モードは以下。
- cpp C++の言語モード。某Kさんのコードコンバーターを通すのでそっちも参照。
- ktpcpicasm PICのアセンブラ。これもcpp同様なのでそっちも参照。
- cmd コンソール。特に加工しないです。バージョンアップに備えて付けておくといいかも。
- syntax 文法記述用。これも特に加工してない。今後実装するかもしれない。
```
（開始指示子）（言語モード）（空白）（ブロック名）（改行）（コード本文）（終了指示子）

｛開始指示子｝：｛コード/折り畳みコードブロックそれぞれ、「```」、「@``」｝
｛言語モード｝：｛ECMAScriptで定義されてる"\S"文字クラスの文字｝
｛ブロック名｝：｛コードブロックの名前。｝
｛コード本文｝：｛どんな文字でもいい。ただし、「```」来ると終わっちゃうので注意｝
｛終了指示子｝：｛「```」｝
```

### 左表、右表ブロック
表です。はい。重要語とか必要語とかはこれ使ってください。「`-`」と「`+`」があって、どっちも使ったら「`-`」が左、「`+`」が右になる。どっちかだけだったら、中央配置になるのでよろしく。タイトルは、「`*-`」と「`*+`」。配置はお察しください。
```
（表）

｛表｝：｛（行要素）...（改行）になる。ただし、"..."は（行要素）がいくら続いても良いの意｝
｛行要素｝：｛（タイトル）又は（項目）｝

｛タイトル｝：｛（タイトル位置指定子）（空白）（タイトル名部分）（改行）｝
｛タイトル位置指定子｝：｛左/右それぞれ「*-」、「*+」｝
｛タイトル名部分｝：｛（通常記法）又は（ホルダー記法）｝

｛項目｝：｛（項目位置指定子）（空白）（見出し部分）（空白）（説明部分）（改行）｝
｛項目位置指定子｝：｛左/右それぞれ「-」、「+」｝
｛見出し部分｝：｛（通常記法）又は（ホルダー記法）｝
｛説明部分｝：｛（通常記法）又は（ホルダー記法）｝

｛通常記法｝：｛（通常文字）｝
｛ホルダー記法｝：｛「{」（同行文字）「}」｝
｛通常文字｝：｛ECMAScriptで定義される"\S"文字クラスの文字｝
｛同行文字｝：｛（改行）以外の文字、ただし"}"があると終わっちゃうので注意｝
```

### preブロック
HTMLを直書き出来る機能です。ただし、articleの外に出しちゃうのは明らかに他と調和しないので、articleには包まれます。  
拡張について：リクエストに指定できるものを複数実装した場合は、複数指定した時に全て適用できるように拡張してください
```
「&(」（リクエスト）「)」（改行）（pre文字列）「&;」

｛リクエスト｝：｛（属性指定）｝
｛属性指定｝：｛「attribute」（空白）（属性文字列）｝
｛属性文字列｝：｛<article ...></article>の...に入る文字列のこと。htmlの文法を守ること。｝

｛pre文字列｝：｛<article>...</article>の...に入る文字列のこと。htmlの文法を守ること。｝
```

## インライン要素
んで、ここまで長々と説明してきたんですけど、一番最後に重要な文章の修飾について説明。現在、`太字`、`コード`、`ルビ`がつかえます。

### 太字
エスケープは「`\**`」と打つと良いでしょう。まあ、同じ文字区間にペアが居なければ問題ないんですけど。
```
「**」（太字対象）「**」

｛太字対象｝：｛太字にする対象の文字列。"*"は含めると終点になっちゃうので注意｝
```

### コード
エスケープなんてありません。使いたくなったら対策します。
```
「`」（コード対象）「`」

｛コード対象｝：｛コードにしたい対象の文字列。"`"は含めると終点になっちゃうので注意｝
```

### ルビ
エスケープの仕方としては、`]`と`(`の間になんかしらの文字（もちろん空白でもいい）を入れる事。まあ要するに、`[...](...)`の形になっていると、反応しちゃうので、`[...] (...)`とかにするといいと思う。
```
「[」（ルビ対象）「]」「(」（ルビ文字列）「)」

｛ルビ対象｝：｛ルビ対象の文字列。"["、"]"は含むことが出来ないので注意｝
｛ルビ文字列｝：｛ルビとして表示する文字列。"("、")"は含むことが出来ないので注意｝
```

# 開発
### 機能開発
機能開発をしたら、ちゃんとこのドキュメントに書いておいて下さい。バージョン更新と、更新履歴の更新を忘れずに、あとコードへのコメントを忘れずに。

# 更新履歴
### v1.0
- リリース 2021/05-06
- 制作者 tomolatoon
#### 内容
全部追加。

### v1.1
- リリース 2021/06/13
- 制作者 tomolatoon
#### 内容
1. 右表と左表について、横幅が短く、右表と左表が上下に並ぶ際、右表と左表がくっついて見えてしまうバグを修正。`margin-top`をマイナス値にするのを、右表と左表にそれぞれ充てていたために発生していた。`cb21 fxlr`->`tntwfg`、`tntwfg debr`->`cb36 debr`。`tntwfg`のCSS定義も修正。
2. 右表と左表の`margin-top`の値を修正。上に寄りすぎていたように見えていたため、マイナス値の度合いを減少させた。

### v1.2
- リリース 2021/06/14
- 制作者 tomolatoon
#### 内容
1. 折り畳み段落の`</article>`が足りなかった問題を修正。

### v1.3
- リリース 2021/06/15
- 制作者 tomolatoon
#### 内容
1. `headerセクション`において、パスが無かった場合、`404.html`へリンクするように修正

### v2.0
- リリース 2021/06/18
- 制作者 tomolatoon
#### 内容
1. HTMLを`mainセクション`において直に埋め込める機能を追加。それに伴ってドキュメントにも追加。