<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8">
  <meta name="keywords" content="駒場東邦物理部,駒場東邦,駒東,KTPC,物理部,電子工作,PIC,講習">
  <meta name="description" content="駒場東邦物理部(KTPC)部員向けPIC講習の資料です。ビットの条件による分岐を解説しています。">
  <meta name="author" content="駒場東邦物理部">
  <meta http-equiv="content-language" content="ja">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>条件分岐 - PIC講習 - 駒場東邦物理部</title>
  <link rel="icon" type="image/jpeg" href="../../../images/logo.jpg">
  <link rel="stylesheet" type="text/css" href="../../../style.css">
  <link rel="stylesheet" type="text/css" media="(max-width:800px)" href="../../../static.css">
  <script type="text/javascript" src="../../../header.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133906591-2"></script>
  <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   
   gtag('config', 'UA-133906591-2');
  </script>
 </head>
 <body>
  <header class="ch00">
   <img class="ch11" src="../../../images/br.jpg">
  </header>
  <div class="chb">
   <div class="ch01">
    <div class="ch10">
     <div class="ch21">
      <button type="button" class="ch31" onclick="ck()">
       <img class="ch42" src="../../../images/menu.png">
      </button>
     </div>
     <div id="hnmu" class="ch22" style="display: none; pointer-events:none;">
      <div class="ch32">
       <span class="ch40">
        <span class="ch50">駒場東邦物理部</span>
       </span>
       <a class="ch41" href="../../../index.html">
        <span class="ch50">トップページ</span>
       </a>
       <a class="ch41" href="../../le.html">
        <span class="ch50">講習トップ</span>
       </a>
      </div>
      <div class="ch32">
       <span class="ch40">
        <span class="ch50">PIC講習</span>
       </span>
       <a class="ch41" href="../bTkcA/bTkcA.html">
        <span class="ch50">前回</span>
       </a>
       <a class="ch41" href="../i_dx/i_dx.html">
        <span class="ch50">索引</span>
       </a>
       <a class="ch41" href="../kadIaDks7A/kadIaDks7A.html">
        <span class="ch50">次回</span>
       </a>
       <a class="ch41" href="../_pic.html">
        <span class="ch50">目次</span>
       </a>
      </div>
     </div>
    </div>
   </div>
   <div class="cb00">
    <div class="cb10">
     <article class="cb20">
      <h1>PIC講習/条件分岐</h1>
     </article>
     <article class="cb21 fxtb">
      <h2 class="cb33">概要</h2>
      <span class="cb34">
       本章では、条件に応じて実行する命令列を変える方法を解説します。
      </span>
     </article>
     <article class="cb21 fxlr">
      <div class="cb36 debr">
       <h4 class="cb44">
        重要語
       </h4>
       <h4 class="cb45">
        スキップ
       </h4>
       <span class="cb41">
        次の命令を実行せず飛ばすこと
       </span>
      </div>
      <div class="cb36 debr">
       <h4 class="cb44">
        必要語
       </h4>
       <h4 class="cb45">
        サイクル
       </h4>
       <span class="cb41">
        命令実行の最小時間単位
       </span>
      </div>
     </article>
     <article class="cb21 fxtb">
      <h2 class="cb33">条件分岐</h2>
      <span class="cb34">
       条件分岐<span class="cb56">Conditional Branch</span>とは、条件に応じて異なる命令列を選択することです。<br>
       これによって、コンピュータは数値を速く計算するだけの機械から大きく進歩しました。
      </span>
     </article>
     <article class="cb21">
      <div class="cb31">
       <h3 class="cb40">スキップ</h3>
       <span class="cb41">
        PICマイコンにおけるスキップ<span class="cb56">Skip</span>とは、機能的には、次の命令を実行せずに飛ばすことです。<br>
        実際には、次の命令を、プログラムメモリの内容にかかわらず、<code class="wdkywd">NOP</code>命令と解釈します。<br>
        これらの表現の間の差異は、スキップしたときの実行時間にあります。<br>
        実際には、<code class="wdkywd">NOP</code>命令1つ分、すなわち1サイクルの時間を要します。
       </span>
      </div>
     </article>
     <article class="cb21">
      <div class="cb31">
       <h3 class="cb40">BCS/BSS命令</h3>
       <span class="cb41">
        <code class="wdkywd">BCS</code>命令は、<code class="wdkywd">BCF</code>命令と同じ引数を持ちます。<br>
        ただし、指定したビットを0にするのではなく、0だった場合にスキップを行います。<br>
        <code class="wdkywd">BSS</code>命令も同様に、1であればスキップを行います。<br>
        スキップが起こらなかった場合は次の命令を実行します。<br>
        また、どの場合でも、指定したビットの値は変更されません。
       </span>
      </div>
     </article>
     <article class="cb21">
      <div class="cb31">
       <h3 class="cb40">複数命令のスキップ</h3>
       <span class="cb41">
        PICのスキップ系命令は、その次の1命令のみしか飛ばせません。<br>
        しかし、<code class="wdkywd">GOT</code>命令などを組み合わせることで、複数の命令を飛ばすことができます。
       </span>
      </div>
     </article>
     <article class="cb21 fxtb">
      <h2 class="cb33">入力による分岐</h2>
      <span class="cb34">
       PORTA/PORTBの特定のビットを条件にすることで、スイッチなどによって操作できるようになります。<br>
       入出力関係のレジスタの設定を忘れないようにしてください。
      </span>
     </article>
     <article class="cb21">
      <div class="cb31">
       <h3 class="cb40">スイッチ付きLチカ</h3>
       <span class="cb41">
        このプログラムは、Lチカのプログラムに4行追加したものです。<br>
        スイッチを押している間のみ点滅するようにしました。<br>
        入力をプルダウンするのを忘れないでください。
       </span>
      </div>
      <img class="cb30" src="j0K3leDwHWH.jpg">
     </article>
     <article class="cb21">
      <div class="cb37">
       <div class="cb46">
        <span class="cb54">スイッチ付きLチカ</span>
        <button type="button" class="cb53" onclick="copy('saco_0')">
         <span class="cb61">COPY</span>
        </button>
       </div>
       <code class="cb47">
<pre id="saco_0" class="cb55 bkgdbl">
  COL.STR.3       #どのバンクからでもアクセス可
    COL.CF.0      #クリアフラグ
    COL.ZF.2      #ゼロフラグ
  COL.TRISA.$0C   #バンク1
  COL.TRISB.$0D   #バンク1
  COL.OSCCON.$19  #バンク1、オシレータ設定
  COL.LATA.$0C    #バンク2
  COL.LATB.$0D    #バンク2
  COL.ANSELA.$0C  #バンク3
  COL.ANSELB.$0D  #バンク3
  COL.WAITA_0.$20 #自由に使えるメモリは$20から
  COL.WAITB_0.$21
  COL.WAITB_1.$22
  
  COL.PWC.$8007 #コンフィギュレーションビット
  WCF.$03.%100  #内蔵オシレータ
  COL.PWC.0     #戻す
  
  MBS.1         #バンク1に移動
  BSF.TRISA.0   #RA0に入力
  CLR.TRISB     #全ピン出力
  MOV.%01101000 #4MHzで内部発振
  MOV.OSCCON.F  #設定する
  MBS.3
  CLR.ANSELA    #アナログ入力は使わない
  MBS.0         #バンク0に戻る
    
  COL.START     #ループ開始
    MOV.%00000001
    MBS.2       #バンク2
    BSF.LATA.0  #RA0が1ならスキップ
      XOR.LATB.F #RB0の出力を反転する
    MBS.0
    CAL.WAITA   #1秒待つ
    GOT.START   #戻る(無限にループする)

  COL.WAITA          #1秒待つ関数
    MOV.100          #0.01秒を100回回す
    MOV.WAITA_0.F    #カウンタに代入
    COL.WAITA-LOOP   #ループ開始
      CAL.WAITB      #0.1秒待つ関数を呼ぶ
      DES.WAITA_0.F  #0ならスキップ
      GOT.WAITA-LOOP #戻る
    RET              #関数を抜ける

  COL.WAITB           #9998サイクルかかる
    MOV.38            #263サイクル*38回=9994サイクル
    MOV.WAITB_0.F     #上の命令、最後のRETと合わせて4サイクル
    COL.WAITB_L0      #1つめのループ(1周263サイクル)
      MOV.87          #3サイクル*87回=261サイクル
      MOV.WAITB_1.F   #上の命令と合わせて2サイクル
      COL.WAITB_L1    #2つめのループ(1周3サイクル)
        DES.WAITB_1.F #通常1、スキップ時2サイクル
        GOT.WAITB_L1  #戻る、2サイクル
        NOP           #スキップ時の誤差1サイクル
      DES.WAITB_0.F
      GOT.WAITB_L0    #戻る
    NOP               #誤差1サイクル
    RET               #関数を抜ける(2サイクル)
</pre>
       </code>
      </div>
     </article>
     <article class="cb21 fxtb">
      <h2 class="cb33">練習問題</h2>
      <span class="cb34">
       理解できたか確認するために、練習問題を解いてもらいます。<br>
       (1) 前項のプログラムを書き換え、スイッチを離している間のみ点滅するようにしてください。<br>
       (2) さらに、RB1ピンにもLEDを付け、交互に点滅するようにしてください。<br>
       (3) RA1ピンにもスイッチを付け、押すと休止状態に入るようにしてください。<br>
       抵抗を忘れずに付けるようにしましょう。<br>
       各問題のように動作するプログラムを書いて、試してみてください。<br>
       うまく動かなければ、間違いがないか確認してください。<br>
       どうしても動かなければ、以下の解答例を見てください。
      </span>
     </article>
     <article class="cb21 fxlr">
      <details class="cb37">
       <summary class="cb48">解答</summary>
       <div class="cb46">
        <span class="cb54">(1)解答例</span>
        <button type="button" class="cb53" onclick="copy('howd_1')">
         <span class="cb61">COPY</span>
        </button>
       </div>
       <code class="cb47">
<pre id="howd_1" class="cb55 bkgdbl">
<span class="paghnw"> <span class="wdkywd">MOV</span><span class="wdsl">.</span><span class="wdnr">$A0</span> <span class="paghti"><span style="display:none;">{{</span>新規追加部<span style="display:none;">}}</span></span></span>
</pre>
       </code>
      </details>
     </article>
    </div>
   </div>
   <footer class="cf00">
    <div class="cf10">
     <button class="cf21" onclick="tp()">
      <img class="cf30" src="../../../images/top.png">
     </button>
     <span class="cf20">
      (C) 2020 駒場東邦物理部[KTPC]
     </span>
    </div>
   </footer>
  </div>
 </body>
</html>
