<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="keywords" content="駒場東邦物理部,駒場東邦,駒東,KTPC,物理部,プログラミング,講習,Vlrfsasm">
        <meta name="description" content="駒場東邦物理部(KTPC)部員向けVlrfsasm講習の資料です。">
        <meta name="author" content="駒場東邦物理部">
        <meta http-equiv="content-language" content="ja">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>仕組み - Vlrfsasm講習 - 駒場東邦物理部</title>
        <link rel="icon" type="image/jpeg" href="../../../images/logo.jpg">
        <link rel="stylesheet" type="text/css" href="../../../tool/vlrfsasmKtpc/style/default.css">
        <link rel="stylesheet" type="text/css" media="(max-width:800px)" href="../../../tool/vlrfsasmKtpc/style/narrow.css">
        <script src="../../../tool/vlrfsasmKtpc/js/search.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-133906591-2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'UA-133906591-2')
        </script>
    </head>
    <body class="hBody">
        <header class="hHeader">
            <image class="hBanner" src="../../../images/br.jpg">
        </header>
        <div class="hBeneathHeader">
            <div class="hMenuSide">
                <div class="hMenuBack">
                    <div class="hMenuButtonBack">
                        <button class="hMenuButton" onclick="menu()">
                            <image class="hMenuButtonImage" src="../../../images/menu.png">
                        </button>
                    </div>
                    <div class="hMenuLink" style="display: none; pointer-events: none;" id="menuLink">
                        <div class="hMenuLinkGroup">
                            <div class="hMenuLinkTitle">
                                <span class="hMenuLinkText">駒場東邦物理部</span>
                            </div>
                            <a class="hMenuLinkElement" href="../../../../../../index.html">
                                <span class="hMenuLinkText">トップページ</span>
                            </a>
                            <a class="hMenuLinkElement" href="../../../../../../le/le.html">
                                <span class="hMenuLinkText">講習一覧</span>
                            </a>
                        </div>
                        <div class="hMenuLinkGroup">
                            <div class="hMenuLinkTitle">
                                <span class="hMenuLinkText">Vlrfsasm講習</span>
                            </div>
                            <a class="hMenuLinkElement" href="../vlrfsasm.html">
                                <span class="hMenuLinkText">講習トップ</span>
                            </a>
                            <a class="hMenuLinkElement" href="../configuration/configuration.html">
                                <span class="hMenuLinkText">設定</span>
                            </a>
                        </div>
                    </div>
                    <div class="hMenuWord" style="display: none; pointer-events: none;" id="menuWord"></div>
                </div>
            </div>
            <div class="hContentSide">
                <div class="hContentBack">
                    <article class="cPageTitleBack">
                        <h1 class="cPageTitle">Vlrfsasm講習/仕組み</h1>
                    </article>
                    <article class="cArticle">
                        <h2 class="cArticleTitle">概要</h2>
                        <div class="cArticleCaption">
                            <p class="cP">本章以降、本HP向けの、Vlrfsasmを用いた変換器について解説します。本章では大まかな構造を示します。次章以降に使い方、最後に技術的な解説を詳しく載せます。</p>
                        </div>
                    </article>
                    <article class="cArticle">
                        <h2 class="cArticleTitle">各部の作用</h2>
                        <div class="cArticleCaption">
                            <p class="cP">この変換器は、大きく5つに分けられます。</p>
                        </div>
                        <section class="cSection">
                            <h2 class="cSectionTitle">実行</h2>
                            <p class="cP">
                                変換器全体の実行を行います。Vlrfsasmのダウンロードと解凍、処理対象の判別の後、対象フォルダ内の
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">vc.bat</span>
                                    </span>
                                </span>
                                を実行します。
                            </p>
                            <p class="cP">
                                この部分にはVlrfsasmのプログラムが含まれておらず、
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">.bat</span>
                                    </span>
                                </span>
                                と
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">.yml</span>
                                    </span>
                                </span>
                                で構成されています。
                            </p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">前処理</h2>
                            <p class="cP">
                                この部分では、
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">vkhc.txt</span>
                                    </span>
                                </span>
                                を
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">temp</span>
                                        <span class="qPathSplit">/</span>
                                        <span class="qPathName">textContent.vlra</span>
                                    </span>
                                </span>
                                に変換します。
                            </p>
                            <p class="cP">Vlrfsasmはどちらかと言えば数値とその計算に主眼が置かれており、文字列が大半のHPの記述には向きません。しかし、別の言語のインタプリタを書くのは非常にコストがかかるため、Vlrfsasmに変換してから処理するようにしています。</p>
                            <p class="cP">
                                また、HTMLでエスケープ必須の3字
                                <span class="cCodeSingleFrame">
                                    <span class="cCodeSingle">
                                        <span class="qPathName">&amp;</span>
                                        <span class="qPathComment">&lt;&gt;</span>
                                    </span>
                                </span>
                                を予め変換し、後の工程での衝突を避けています。
                            </p>
                            <p class="cP">詳しくは後の章で解説しますが、拡張表現や表の構文も、この前処理段階でVlrfsasmの表記に変換されます。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">HTML</h2>
                            <p class="cP">この変換器の目的は、HTMLの記述を楽にすることでした。そのため、この部分が本体であると言えます。しかしながら、実装はこの部分が最も簡単でした。</p>
                            <p class="cP">基本的にはHTMLのタグ構造を造る関数群ですが、全ページで共通である、メニューや下部のフッターなどは直書きしてしまっています。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">コード彩色</h2>
                            <p class="cP">プログラムのソースコードに、符ごとの色を付ける部分です。最も複雑な部分であり、記述にもかなりの手間がかかりました。</p>
                            <p class="cP">現在、プログラミング言語ではVlrfsasmとC言語にしか対応していませんが、必要に応じて字句規則を追加することができます。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">数式</h2>
                            <p class="cP">指数や分数、根号など、数式の表示を行う部分です。競技プログラミングや、電工班の物理の式に使えるのではないかと思います。</p>
                            <p class="cP">出力関数のhtmlに組み込むため、svg形式にしています。使っているフォントは、少し改造したComputer Modernです。フォントファイルからサイズを抽出し、描画する座標を計算しています。</p>
                        </section>
                    </article>
                    <article class="cArticle">
                        <h2 class="cArticleTitle">経緯</h2>
                        <div class="cArticleCaption">
                            <p class="cP">この変換器ができた経緯は以下の通りです。読まなくても構いません。</p>
                        </div>
                        <section class="cSection">
                            <h2 class="cSectionTitle">物理部HP</h2>
                            <p class="cP">物理部のHPはかなり昔から存在していました。FC2に2009年の記事が残っています。もう少し前のものもあったような気がしますが、消えてしまったのかもしれません。その後、62回生が2019年ごろにGoogle Sitesへ、63回生が2020年にGitHub Pagesに移しました。</p>
                            <p class="cP">FC2にはマークダウンがありますし、Google SitesはGUIで編集できました。GitHub Pagesもマークダウンを使えるのですが、移行した部員はひねくれていたので、全てHTMLとCSSで書こうとしました。</p>
                            <p class="cP">しかし、63回生は2020年に高2へ上がったわけですから、特に新歓以降はかなり忙しくなりました。CSSのクラス名などはほとんど数字という有様で、非効率を作業量で補っていました。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">旧コード彩色器</h2>
                            <p class="cP">Github Pagesに移行した直後は、コードの彩色機能はありませんでした。これは、当時この部員がアセンブリの講習資料を書いており、必要な箇所に下線を引く程度で解決できると思っていたからです。字句解析器の作成のコストがかなり高いことも知っていました。</p>
                            <p class="cP">ところが、2020年のお盆の前になり、競技プログラミング講習を書いていた部員が、外部の彩色サービスを使っていたことがわかりました。ここで前言を撤回し、javascriptによる彩色器を作ってみたところ、意外と素直にできてしまいました。焦っていたために、美しさを無視しましたが、差し当たり大きな問題は起きませんでした。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">Vlrfsasm</h2>
                            <p class="cP">結局、GitHub Pagesへの移行を行った部員は、2020年の11月に引退しました。その後は勉強に専念しようと思ってはいたようです。ところが、この部員にはハードルが2つありました。</p>
                            <p class="cP">まず、PICマイコンのアセンブリの講習資料、並びにHPそのものの講習資料などを書き終えていませんでした。非効率な作業はまだ山積みだったのです。</p>
                            <p class="cP">さらに、ちょっとした拍子に発作を起こし、プログラミング言語の設計を始めるという、やっかいな癖がありました。案の定、2021年の2月には、処理系の設計に取り掛かってしまいます。しかし、3月になると、PICマイコンのアセンブラを書いた経験などから、大きすぎて完成しないだろう、という予測が立ちました。</p>
                            <p class="cP">ここで、Vlrfsasmの開発が始まりました。これは、コンパイラの最終段階であるアセンブラを先に作ることで、終点を明らかにし、途中のプログラムを減らすためでした。しかし、開発中に、Vlrfsasmの有用性に気づいてしまいます。まず、それまで使っていた単純な記法に比べ、x64の記述量を3分の1程度にできることがわかりました。さらに、PICマイコンのアセンブラも、とても簡単に実装できることがわかってしまいます。</p>
                            <p class="cP">ここまでくれば、HP向け変換器としても使う計画が出てきました。勉強する意思はどこに行ってしまったのでしょうか。</p>
                        </section>
                        <section class="cSection">
                            <h2 class="cSectionTitle">変換器</h2>
                            <p class="cP">ともかく、Vlrfsasmの開発と並行して、実装すべきHTMLの要素などを整理しました。2021年の10月ごろからは本格的に実装を始め、11月にコード彩色、12月に数式表示のライブラリを書きました。その後は講習資料を書いているようです。1年以上経って、ようやく本来の目的に取り掛かれたのです。これを反面教師として、引退前に講習資料を完成させることを、強く勧めます。</p>
                        </section>
                    </article>
                </div>
            </div>
            <div class="hFooterSide">
                <footer class="hFooter">
                    <button class="hFooterButton" onclick="scrollToTop()">
                        <image class="hFooterButtonImage" src="../../../images/top.png">
                    </button>
                    <span class="hFooterText">(C) 2020 駒場東邦物理部</span>
                </footer>
            </div>
        </div>
    </body>
</html>
